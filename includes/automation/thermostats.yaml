# =================== Heaters Automations ===================

    - alias: climate_turn_on_heaters
      description: 'Включение обогревателей'
      trigger:
        - platform: state
          entity_id: input_boolean.heating_status
          to: 'on'
      condition:
        - condition: state
          entity_id: group.heaters
          state: 'off'
      action:
        - choose: # living_room
            - conditions:
                - condition: state
                  entity_id: binary_sensor.living_room_loggia_door_contact
                  state: 'off'
              sequence: 
                - service: climate.turn_on
                  entity_id: climate.living_room_heater
        - choose: # kitchen
            - conditions: 
                - condition: state
                  entity_id: binary_sensor.kitchen_window_contact
                  state: 'off'
              sequence:
                - service: climate.turn_on
                  entity_id: climate.kitchen_heater
        - choose: # bedroom
            - conditions:
                - condition: state
                  entity_id: binary_sensor.bedroom_windows
                  state: 'off'
              sequence:
                - service: climate.turn_on
                  entity_id: climate.bedroom_heater
        - choose: # Set Away/Home mode
            - conditions:
                - condition: not
                  conditions:
                  - condition: state
                    entity_id: group.family
                    state: 'home'
              sequence:
                - service: climate.set_preset_mode
                  target:
                    entity_id: group.heaters
                  data:
                    preset_mode: 'away'
          default:
            - service: climate.set_preset_mode
              target:
                entity_id: group.heaters 
              data:
                preset_mode: 'none'
        - choose: # check A/C to be off
            - conditions:
                - condition: state
                  entity_id: input_boolean.ac_status
                  state: 'on'
              sequence: 
                - service: input_boolean.turn_off
                  entity_id: input_boolean.ac_status

    - alias: climate_turn_off_heaters
      description: 'Выключение обогревателей'
      trigger:
        - platform: state
          entity_id: input_boolean.heating_status
          to: 'off'
      action:
        - service: climate.turn_off
          entity_id: group.heaters
        # Enable A/C
        - service: input_boolean.turn_on
          entity_id: input_boolean.ac_status

    - alias: climate_winter_turn_on_heaters
      description: 'Наступила зима, обогреватели включены'
      trigger:
        - platform: state
          entity_id: sensor.season
          to: 'winter'
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'off'
      action:
        - service: input_boolean.turn_on
          entity_id: input_boolean.heating_status
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U00002603"}} Пришла Зима{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватели Включены.

    - alias: climate_summer_turn_off_heaters
      description: 'Наступило лето, обогреватели выключены'
      trigger:
        - platform: state
          entity_id: sensor.season
          to: 'summer'
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
      action:
        - service: input_boolean.turn_off
          entity_id: input_boolean.heating_status
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U00002600"}} Пришло Лето{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватели Отключены.

    - alias: climate_spring_fall_turn_on_heaters
      description: 'Включение термостатов отопления весной/осенью при наружной температуре ниже 15'
      trigger:
        - platform: numeric_state
          entity_id: sensor.outdoor_mean_temperature
          below: 10
          for:
            hours: 3
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: sensor.season
            state: 'spring'
          - condition: state
            entity_id: sensor.season
            state: 'autumn'
      action:
        - service: input_boolean.turn_on
          entity_id: input_boolean.heating_status
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F927"}} Похолодало{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Наружная температура ниже 15{{"\U00002103"}}, обогреватели включены.

    - alias: climate_spring_fall_turn_off_heaters
      description: 'Выключение термостатов отопления весной/осенью при наружной температуре выше 15'
      trigger:
        - platform: numeric_state
          entity_id: sensor.outdoor_mean_temperature
          above: 10
          for:
            hours: 3
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - condition: or
          conditions:
          - condition: state
            entity_id: sensor.season
            state: 'spring'
          - condition: state
            entity_id: sensor.season
            state: 'autumn'
      action:
        - service: input_boolean.turn_off
          entity_id: input_boolean.heating_status
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F917"}} Потеплело{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Наружная температура выше 15{{"\U00002103"}}, обогреватели отключены.

    - alias: climate_heating_thermostats_away
      description: 'Переключение термостатов в режим - away'
      trigger:
      - entity_id: group.family
        platform: state
        to: not_home
      condition: 
        - condition: state
          entity_id: input_boolean.disable_home_away
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: not
          conditions:
          - condition: state
            entity_id: group.family
            state: 'home'
      action:
        - service: climate.set_preset_mode
          target:
            entity_id: group.heaters
          data:
            preset_mode: 'away'
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        # Уведомление о смене режима отопления
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Все покинули Дом{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватели переключены в режим экономии ({{ state_attr("climate.living_room_heater","temperature") }}{{"\U00002103"}}).

    - alias: climate_heating_thermostats_home
      description: 'Переключение термостатов в режим - home'
      trigger:
      - entity_id: group.family
        platform: state
        to: home
      condition: 
        - condition: state
          entity_id: input_boolean.disable_home_away
          state: 'off'
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - condition: state
          entity_id: group.family
          state: 'home'
      action:
        - service: climate.set_preset_mode
          target:
            entity_id: group.heaters 
          data:
            preset_mode: 'none'
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        # Уведомление о смене режима отопления
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Дома кто-то появился{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватели переключены в нормальный режим ({{ state_attr("climate.living_room_heater","temperature") }}{{"\U00002103"}}).

    - alias: climate_loggia_door_opened_turn_off_heater
      description: 'Выключение обогревателя в гостинной при открытой двери на лоджию'
      trigger:
        - type: opened
          platform: device
          device_id: 19904350a3cc7a64c7db5fe737b6d044
          entity_id: binary_sensor.living_room_loggia_door_contact
          domain: binary_sensor
          for:
            minutes: 5
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - condition: state
          entity_id: climate.living_room_heater
          state: 'heat'
      action:
        - service: climate.turn_off
          entity_id: climate.living_room_heater
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Открыта дверь на лоджию{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватель в Гостинной выключен{{"\U0000203C"}}

    - alias: climate_loggia_door_closed_turn_on_heater
      description: 'Включение обогревателя в гостинной при закрытой двери на лоджию'
      trigger:
        - type: not_opened
          platform: device
          device_id: 19904350a3cc7a64c7db5fe737b6d044
          entity_id: binary_sensor.living_room_loggia_door_contact
          domain: binary_sensor
          for:
            minutes: 1
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - condition: state
          entity_id: climate.living_room_heater
          state: 'off'
      action:
        - service: climate.turn_on
          entity_id: climate.living_room_heater
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Дверь на лоджию закрыта{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватель в Гостинной включен{{"\U0000203C"}}

    - alias: climate_kitchen_window_opened_turn_off_heater
      description: 'Выключение обогревателя в кухне при открытом окне'
      trigger:
        - type: opened
          platform: device
          device_id: 1302f3abc6e95ef58820671b5a312ef9
          entity_id: binary_sensor.kitchen_window_contact
          domain: binary_sensor
          for:
            minutes: 5
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - condition: state
          entity_id: climate.kitchen_heater
          state: 'heat'
      action:
        - service: climate.turn_off
          entity_id: climate.kitchen_heater
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Открыто окно на кухне{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватель в Кухне выключен{{"\U0000203C"}}

    - alias: climate_kitchen_window_closed_turn_on_heater
      description: 'Включение обогревателя в кухне при закрытом окне'
      trigger:
        - type: not_opened
          platform: device
          device_id: 1302f3abc6e95ef58820671b5a312ef9
          entity_id: binary_sensor.kitchen_window_contact
          domain: binary_sensor
          for:
            minutes: 1
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - condition: state
          entity_id: climate.kitchen_heater
          state: 'off'
      action:
        - service: climate.turn_on
          entity_id: climate.kitchen_heater
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Окно на кухне закрыто{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватель в Кухне включен{{"\U0000203C"}}

    - alias: climate_bedroom_window_opened_turn_off_heater
      description: 'Выключение обогревателя в спальне при открытых окнах'
      trigger:
        - platform: state
          entity_id: binary_sensor.bedroom_windows
          to: 'on'
          for:
            minutes: 3
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - condition: state
          entity_id: climate.bedroom_heater
          state: 'heat'
      action:
        - service: climate.turn_off
          entity_id: climate.bedroom_heater
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Открыто окно в спальне{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватель в Спальне выключен{{"\U0000203C"}}

    - alias: climate_bedroom_windows_closed_turn_on_heater
      description: 'Включение обогревателя в спальне при закрытых окнах'
      trigger:
        - platform: state
          entity_id: binary_sensor.bedroom_windows
          to: 'off'
          for:
            minutes: 1
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.bedroom_windows
          state: 'off'
        - condition: state
          entity_id: climate.bedroom_heater
          state: 'off'
      action:
        - service: climate.turn_on
          entity_id: climate.bedroom_heater
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Окна в спальне закрыты{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Обогреватель в Спальне включен{{"\U0000203C"}}

    - alias: climate_heaters_settings_on_statrup
      description: 'Установки термостатов при старте системы'
      trigger: 
        - platform: homeassistant
          event: start
      condition: 
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
      action:
        - service: automation.trigger
          entity_id: automation.climate_turn_off_heaters
        - condition: state
          entity_id: input_boolean.heating_status
          state: 'on'
        - delay: 
            minutes: 3
        - service: automation.trigger
          entity_id: automation.climate_turn_on_heaters

# =================== A/C Automations ===================

    - alias: climate_enable_ac
      description: 'Использование кондиционирования разрешено'
      trigger:
        - platform: state
          entity_id: input_boolean.ac_status
          to: 'on'
      action:
        - choose: # check if Heating to be off
            - conditions:
                - condition: state
                  entity_id: input_boolean.heating_status
                  state: 'on'
              sequence: 
                - service: input_boolean.turn_off
                  entity_id: input_boolean.heating_status

    - alias: climate_turn_on_ac
      description: 'Включение кондиционеров при температуре в помещении выше 26'
      trigger:
        - platform: time_pattern
          minutes: "/5"
      condition:
        - condition: time
          after: "08:00:00"
          before: "23:00:00"
        - condition: or
          conditions:
            - condition: numeric_state
              entity_id: sensor.living_room_lumi_weather_temperature
              above: 26
            - condition: numeric_state
              entity_id: sensor.bedroom_lumi_weather_temperature
              above: 26
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - condition: state
          entity_id: group.family
          state: 'home'
      action:
        - choose: # living_room
            - conditions:
                - condition: state
                  entity_id: binary_sensor.living_room_loggia_door_contact
                  state: 'off'
                - condition: state
                  entity_id: binary_sensor.living_room_air_conditioner_socket_power
                  state: 'off'
                - condition: numeric_state
                  entity_id: sensor.living_room_lumi_weather_temperature
                  above: 26
              sequence: 
                - service: switch.turn_on
                  entity_id: switch.living_room_air_conditioner_socket
                - delay: 20
                - service: climate.turn_on
                  entity_id: climate.living_room_ac
                - condition: state
                  entity_id: input_boolean.disable_climate_notifications
                  state: 'off'
                - service: notify.alexus
                  data:
                    title: '{{"\U0001F975"}} Жарко{{"\U0000203C"}}'
                    message: |
                      ➖➖➖➖➖➖➖➖➖➖➖➖
                      Температура в Гостинной {{ states("sensor.living_room_lumi_weather_temperature") | round(1) }}{{"\U00002103"}}{{"\U0000203C"}}
                      Включение кондиционера...
        - choose: # bedroom
            - conditions:
                - condition: state
                  entity_id: binary_sensor.bedroom_windows
                  state: 'off'
                - condition: state
                  entity_id: binary_sensor.bedroom_air_conditioner_socket_power
                  state: 'off'
                - condition: numeric_state
                  entity_id: sensor.bedroom_lumi_weather_temperature
                  above: 26
              sequence:
                - service: switch.turn_on
                  entity_id: switch.bedroom_air_conditioner_socket
                - delay: 20
                - service: climate.turn_on
                  entity_id: climate.bedroom_ac
                - condition: state
                  entity_id: input_boolean.disable_climate_notifications
                  state: 'off'
                - service: notify.alexus
                  data:
                    title: '{{"\U0001F975"}} Жарко{{"\U0000203C"}}'
                    message: |
                      ➖➖➖➖➖➖➖➖➖➖➖➖
                      Температура в Спальне {{ states("sensor.bedroom_lumi_weather_temperature") | round(1) }}{{"\U00002103"}}{{"\U0000203C"}}
                      Включение кондиционера...

    - alias: climate_turn_off_ac
      description: 'Выключение кондиционеров при внутренней температуре ниже 24'
      trigger:
        - platform: time_pattern
          minutes: "/5"
      condition:
        - condition: time
          after: "08:00:00"
          before: "23:00:00"
        - condition: or
          conditions:
            - condition: numeric_state
              entity_id: sensor.living_room_lumi_weather_temperature
              below: 24
            - condition: numeric_state
              entity_id: sensor.bedroom_lumi_weather_temperature
              below: 24
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - condition: state
          entity_id: group.air_conditioners
          state: 'on'
      action:
        - choose: # living_room
            - conditions:
                - condition: state
                  entity_id: binary_sensor.living_room_air_conditioner_socket_power
                  state: 'on'
                - condition: numeric_state
                  entity_id: sensor.living_room_lumi_weather_temperature
                  below: 24
              sequence: 
                - service: climate.turn_off
                  entity_id: climate.living_room_ac
                - delay: 20
                - service: switch.turn_off
                  entity_id: switch.living_room_air_conditioner_socket
                - service: input_boolean.turn_off
                  entity_id: input_boolean.living_room_ac_status
                - condition: state
                  entity_id: input_boolean.disable_climate_notifications
                  state: 'off'
                - service: notify.alexus
                  data:
                    title: '{{"\U0001F976"}} Прохладно{{"\U0000203C"}}'
                    message: |
                      ➖➖➖➖➖➖➖➖➖➖➖➖
                      Температура в Гостинной {{ states("sensor.living_room_lumi_weather_temperature") | round(1) }}{{"\U00002103"}}{{"\U0000203C"}}
                      Выключение кондиционера...
        - choose: # bedroom
            - conditions:
                - condition: state
                  entity_id: binary_sensor.bedroom_air_conditioner_socket_power
                  state: 'on'
                - condition: numeric_state
                  entity_id: sensor.bedroom_lumi_weather_temperature
                  below: 24
              sequence:
                - service: climate.turn_off
                  entity_id: climate.bedroom_ac
                - delay: 20
                - service: switch.turn_off
                  entity_id: switch.bedroom_air_conditioner_socket
                - service: input_boolean.turn_off
                  entity_id: input_boolean.bedroom_ac_status
                - condition: state
                  entity_id: input_boolean.disable_climate_notifications
                  state: 'off'
                - service: notify.alexus
                  data:
                    title: '{{"\U0001F976"}} Прохладно{{"\U0000203C"}}'
                    message: |
                      ➖➖➖➖➖➖➖➖➖➖➖➖
                      Температура в Спальне {{ states("sensor.bedroom_lumi_weather_temperature") | round(1) }}{{"\U00002103"}}{{"\U0000203C"}}
                      Выключение кондиционера...

    - alias: climate_night_turn_off_ac
      description: 'Выключение кондиционеров на ночь'
      trigger:
        - platform: time
          at: '23:00:00'
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - condition: state
          entity_id: group.air_conditioners
          state: 'on'
      action:
        - service: climate.turn_off
          entity_id: group.air_conditioners
        - delay: 20
        - service: switch.turn_off
          target:
            entity_id: 
              - switch.bedroom_air_conditioner_socket
              - switch.living_room_air_conditioner_socket
        - service: input_boolean.turn_off
          entity_id:
            - input_boolean.living_room_ac_status
            - input_boolean.bedroom_ac_status
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F634"}} Спокойной ночи{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Кондиционеры выключаются на ночь{{"\U0000203C"}}

    - alias: climate_loggia_door_opened_turn_off_ac
      description: 'Выключение кондиционера в гостинной при открытой двери на лоджию'
      trigger:
        - type: opened
          platform: device
          device_id: 19904350a3cc7a64c7db5fe737b6d044
          entity_id: binary_sensor.living_room_loggia_door_contact
          domain: binary_sensor
          for:
            minutes: 3
      condition:
        - condition: time
          after: "08:00:00"
          before: "23:00:00"
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - not:
            - condition: state
              entity_id: climate.living_room_ac
              state: 'off'
      action:
        - service: input_boolean.turn_on
          entity_id: input_boolean.living_room_ac_status
        - service: climate.turn_off
          entity_id: climate.living_room_ac
        - delay: 20
        - service: switch.turn_off
          entity_id: switch.living_room_air_conditioner_socket
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F6AA"}} Открыта дверь на Лоджию{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Дверь в Гостинной на Лоджию открыта{{"\U0000203C"}}
              Выключение кондиционера...

    - alias: climate_loggia_door_closed_turn_on_ac
      description: 'Включение кондиционера в гостинной при закрытой двери на лоджию'
      trigger:
        - type: not_opened
          platform: device
          device_id: 19904350a3cc7a64c7db5fe737b6d044
          entity_id: binary_sensor.living_room_loggia_door_contact
          domain: binary_sensor
          for:
            minutes: 1
      condition:
        - condition: time
          after: "08:00:00"
          before: "23:00:00"
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - condition: state
          entity_id: climate.living_room_ac
          state: 'off'
        - condition: state
          entity_id: input_boolean.living_room_ac_status
          state: 'on'
      action:
        - service: switch.turn_on
          entity_id: switch.living_room_air_conditioner_socket
        - delay: 20
        - service: climate.turn_on
          entity_id: climate.living_room_ac
        - service: input_boolean.turn_off
          entity_id: input_boolean.living_room_ac_status
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F6AA"}} Дверь на Лоджию закрыта{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Дверь в Гостинной на Лоджию закрыта{{"\U0000203C"}}
              Включение кондиционера...

    - alias: climate_bedroom_window_opened_turn_off_ac
      description: 'Выключение кондициорена в спальне при открытых окнах'
      trigger:
        - platform: state
          entity_id: binary_sensor.bedroom_windows
          to: 'on'
          for:
            minutes: 3
      condition:
        - condition: time
          after: "08:00:00"
          before: "23:00:00"
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - not:
            - condition: state
              entity_id: climate.bedroom_ac
              state: 'off'
      action:
        - service: input_boolean.turn_on
          entity_id: input_boolean.bedroom_ac_status
        - service: climate.turn_off
          entity_id: climate.bedroom_ac
        - delay: 20
        - service: switch.turn_off
          entity_id: switch.bedroom_air_conditioner_socket
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001FA9F"}}{{"\U0001FA9F"}} Открыто окно в Спальне{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Окно в Спальне открыто{{"\U0000203C"}}
              Выключение кондиционера...

    - alias: climate_bedroom_windows_closed_turn_on_ac
      description: 'Включение кондиционера в спальне при закрытых окнах'
      trigger:
        - platform: state
          entity_id: binary_sensor.bedroom_windows
          to: 'off'
          for:
            minutes: 1
      condition:
        - condition: time
          after: "08:00:00"
          before: "23:00:00"
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - condition: state
          entity_id: input_boolean.bedroom_ac_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.bedroom_windows
          state: 'off'
        - condition: state
          entity_id: climate.bedroom_ac
          state: 'off'
      action:
        - service: switch.turn_on
          entity_id: switch.bedroom_air_conditioner_socket
        - delay: 20
        - service: climate.turn_on
          entity_id: climate.bedroom_ac
        - service: input_boolean.turn_off
          entity_id: input_boolean.bedroom_ac_status
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001FA9F"}}{{"\U0001FA9F"}} Окна в Спальне закрыты{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Все окна в Спальне закрыты{{"\U0000203C"}}
              Включение кондиционера...

    - alias: climate_ac_turn_off_away
      description: 'Выключение кондиционеров если никого нет дома'
      trigger:
      - entity_id: group.family
        platform: state
        to: not_home
      condition: 
        - condition: time
          after: "08:00:00"
          before: "23:00:00"
        - condition: state
          entity_id: input_boolean.disable_home_away
          state: 'off'
        - condition: state
          entity_id: input_boolean.disable_climate
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - condition: state
          entity_id: group.air_conditioners
          state: 'on'
        - condition: not
          conditions:
          - condition: state
            entity_id: group.family
            state: 'home'
      action:
        - service: climate.turn_off
          entity_id: group.air_conditioners
        - delay: 20
        - service: switch.turn_off
          target:
            entity_id: 
              - switch.bedroom_air_conditioner_socket
              - switch.living_room_air_conditioner_socket
        - service: input_boolean.turn_off
          entity_id:
            - input_boolean.living_room_ac_status
            - input_boolean.bedroom_ac_status
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Все покинули Дом{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Дома никого нет{{"\U0000203C"}}
              Выключение кондиционеров...

    - alias: climate_living_room_ac_turn_on_manual
      description: 'Включение кондиционера в Гостинной в ручном режиме'
      trigger:
        - platform: state
          entity_id: climate.living_room_ac
          from: 'off'
      condition:
        - condition: state
          entity_id: switch.living_room_air_conditioner_socket
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.living_room_loggia_door_contact
          state: 'off'
      action:
        - service: switch.turn_on
          entity_id: switch.living_room_air_conditioner_socket
        - delay: 20
        - service: climate.turn_on
          entity_id: climate.living_room_ac

    - alias: climate_bedroom_ac_turn_on_manual
      description: 'Включение кондиционера в Спальне в ручном режиме'
      trigger:
        - platform: state
          entity_id: climate.bedroom_ac
          from: 'off'
      condition:
        - condition: state
          entity_id: switch.bedroom_air_conditioner_socket
          state: 'off'
        - condition: state
          entity_id: input_boolean.ac_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.bedroom_windows
          state: 'off'
      action:
        - service: switch.turn_on
          entity_id: switch.bedroom_air_conditioner_socket
        - delay: 20
        - service: climate.turn_on
          entity_id: climate.bedroom_ac

    - alias: climate_bedroom_ac_status_notification
      description: 'Сообщение о статусе кондиционера в Спальне'
      trigger:
        - platform: state
          entity_id: binary_sensor.bedroom_air_conditioner_socket_power
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
      action:
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Уведомление{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Кондиционер в Спальне {% if is_state("binary_sensor.bedroom_air_conditioner_socket_power","on") %} включен{% else %} выключен{% endif %}{{"\U0000203C"}}
              Текущая температура: {{ states("sensor.bedroom_lumi_weather_temperature") | round(1) }}{{"\U00002103"}}

    - alias: climate_living_room_ac_status_notification
      description: 'Сообщение о статусе кондиционера в Гостинной'
      trigger:
        - platform: state
          entity_id: binary_sensor.living_room_air_conditioner_socket_power
      condition:
        - condition: state
          entity_id: input_boolean.disable_climate_notifications
          state: 'off'
      action:
        - service: notify.alexus
          data:
            title: '{{"\U0001F3E0"}} Уведомление{{"\U0000203C"}}'
            message: |
              ➖➖➖➖➖➖➖➖➖➖➖➖
              Кондиционер в Гостинной {% if is_state("binary_sensor.living_room_air_conditioner_socket_power","on") %} включен{% else %} выключен{% endif %}{{"\U0000203C"}}
              Текущая температура: {{ states("sensor.living_room_lumi_weather_temperature") | round(1) }}{{"\U00002103"}}

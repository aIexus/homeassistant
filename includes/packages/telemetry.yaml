telemetry_config:
# Main idea took from https://github.com/kvazis/training/tree/master/lessons/articles/unit%20telemetry%203

    homeassistant:

        customize:

            sensor.count_automations:
                friendly_name: 'Автоматизацій у системі -'
            sensor.count_automations_on:
                friendly_name: 'Активні автоматизації -'
            sensor.count_automations_off:
                friendly_name: 'Вимкнені автоматизації -'
            sensor.count_automations_unavailable:
                friendly_name: 'Недоступні автоматизації -'
            sensor.count_scripts:
                friendly_name: 'Скриптів у системі -'
            sensor.count_scripts_on:
                friendly_name: 'Активні скрипти -'
            sensor.count_scripts_off:
                friendly_name: 'Вимкнені скрипти -'
            sensor.count_scripts_unavailable:
                friendly_name: 'Недоступні скрипти -'
            sensor.count_updates:
                friendly_name: 'Додатків у системі -'
            sensor.count_updates_on:
                friendly_name: 'Доступно оновлень -'
            sensor.count_lights:
                friendly_name: 'Світильників у системі -'
            sensor.count_lights_on:
                friendly_name: 'Активні світильники -'
            sensor.count_lights_off:
                friendly_name: 'Вимкнені світильники -'
            sensor.count_lights_unavailable:
                friendly_name: 'Недоступні світильники - '
            sensor.count_switches:
                friendly_name: 'Реле у системі -'
            sensor.count_switches_on:
                friendly_name: 'Активні реле -'
            sensor.count_switches_off:
                friendly_name: 'Вимкнені реле -'
            sensor.count_switches_unavailable:
                friendly_name: 'Недоступні реле -'
            sensor.count_climate:
                friendly_name: 'Термостатів у системі -'
            sensor.climate_on:
                friendly_name: 'Активні термостати -'
            sensor.climate_off:
                friendly_name: 'Вимкнені термостати -'
            sensor.count_climate_unavailable:
                friendly_name: 'Недоступні термостати -'
            sensor.count_sensors:
                friendly_name: 'Сенсорів у системі -'
            sensor.count_sensors_unavailable:
                friendly_name: 'Недоступні сенсори -'
            sensor.count_binary_sensors:
                friendly_name: 'Бінарних сенсорів у системі -'
            sensor.count_binary_sensors_unavailable:
                friendly_name: 'Недоступні бінарні сенсори -'
            sensor.count_cameras:
                friendly_name: 'Камер у системі -'
            sensor.count_cameras_unavailable:
                friendly_name: 'Недоступні камери -'

    input_button:

        telemetry_reload:
            name: 'Оновлення телеметрії'
            icon: mdi:reload

    template:

      - sensor:

          - name: count_automations
            state: >
                  {%- set domains = ['automation'] -%}
                  {%- for domain in domains -%}
                    {%- for item in states[domain] -%}
                      {% if loop.first %}
                        {{loop.length}}
                      {% endif %}
                    {%- endfor -%}
                  {%- endfor -%}
            icon: mdi:head

          - name: count_automations_on
            state: "{{states.automation | selectattr ('state', 'equalto', 'on') | list | length}}"
            icon: mdi:head-check

          - name: count_automations_off
            state: "{{states.automation | selectattr ('state', 'equalto', 'off') | list | length}}"
            icon: mdi:head-remove            

          - name: count_automations_unavailable
            state: "{{states.automation | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon: mdi:head-question

          - name: count_scripts
            state: >
                  {%- set domains = ['script'] -%}
                  {%- for domain in domains -%}
                    {%- for item in states[domain] -%}
                      {% if loop.first %}
                        {{loop.length}}
                      {% endif %}
                    {%- endfor -%}
                  {%- endfor -%}
            icon: mdi:file
            
          - name: count_scripts_on
            state: "{{states.script | selectattr ('state', 'equalto', 'on') | list | length}}"
            icon: mdi:file-check

          - name: count_scripts_off
            state: "{{states.script | selectattr ('state', 'equalto', 'off') | list | length}}"
            icon: mdi:file-remove            

          - name: count_scripts_unavailable
            state: "{{states.script | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon: mdi:file-question

          - name: count_updates
            state: >
                  {%- set domains = ['update'] -%}
                  {%- for domain in domains -%}
                    {%- for item in states[domain] -%}
                      {% if loop.first %}
                        {{loop.length}}
                      {% endif %}
                    {%- endfor -%}
                  {%- endfor -%}
            icon: mdi:monitor-dashboard
            
          - name: count_updates_on
            state: "{{states.update | selectattr ('state', 'equalto', 'on') | list | length}}"
            icon: mdi:monitor-arrow-down-variant

          - name: count_lights
            state: >
                  {%- set domains = ['light'] -%}
                  {%- for domain in domains -%}
                    {%- for item in states[domain] -%}
                      {% if loop.first %}
                        {{loop.length}}
                      {% endif %}
                    {%- endfor -%}
                  {%- endfor -%}
            icon: mdi:lightbulb-group
            
          - name: count_lights_on
            state: "{{states.light | selectattr ('state', 'equalto', 'on') | list | length}}"
            icon: mdi:lightbulb-on

          - name: count_lights_off
            state: "{{states.light | selectattr ('state', 'equalto', 'off') | list | length}}"
            icon: mdi:lightbulb

          - name: count_lights_unavailable
            state: "{{states.light | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon: mdi:lightbulb-question

          - name: count_switches
            state: >
                  {%- set domains = ['switch'] -%}
                  {%- for domain in domains -%}
                    {%- for item in states[domain] -%}
                      {% if loop.first %}
                        {{loop.length}}
                      {% endif %}
                    {%- endfor -%}
                  {%- endfor -%}
            icon: mdi:power
            
          - name: count_switches_on
            state: "{{states.switch | selectattr ('state', 'equalto', 'on') | list | length}}"
            icon: mdi:power-plug

          - name: count_switches_off
            state: "{{states.switch | selectattr ('state', 'equalto', 'off') | list | length}}"
            icon: mdi:power-plug-off

          - name: count_switches_unavailable
            state: "{{states.switch | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon: mdi:power-plug-outline

          - name: count_climate
            state: >
                  {%- set domains = ['climate'] -%}
                  {%- for domain in domains -%}
                    {%- for item in states[domain] -%}
                      {% if loop.first %}
                        {{loop.length}}
                      {% endif %}
                    {%- endfor -%}
                  {%- endfor -%}
            icon: mdi:thermostat
            
          - name: count_climate_on
            state: "{{states.climate | selectattr ('state', 'in', ['heat', 'heat_cool', 'fan_only', 'dry', 'cool', 'heat']) | list | length}}"
            icon: mdi:thermometer-plus

          - name: count_climate_off
            state: "{{states.climate | selectattr ('state', 'equalto', 'off') | list | length}}"
            icon: mdi:thermometer-minus

          - name: count_climate_unavailable
            state: "{{states.climate | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon: mdi:thermometer-alert

          - name: count_sensors
            state: >
                  {%- set domains = ['sensor'] -%}
                  {%- for domain in domains -%}
                    {%- for item in states[domain] -%}
                      {% if loop.first %}
                        {{loop.length}}
                      {% endif %}
                    {%- endfor -%}
                  {%- endfor -%}
            icon: mdi:eye
            
          - name: count_sensors_unavailable
            state: "{{states.sensor | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon: mdi:eye-off

          - name: count_binary_sensors
            state: >
                  {%- set domains = ['binary_sensor'] -%}
                  {%- for domain in domains -%}
                    {%- for item in states[domain] -%}
                      {% if loop.first %}
                        {{loop.length}}
                      {% endif %}
                    {%- endfor -%}
                  {%- endfor -%}
            icon: mdi:numeric-10-circle
            
          - name: count_binary_sensors_unavailable
            state: "{{states.binary_sensor | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon: mdi:alert-circle

          - name: count_cameras
            state: >
                  {%- set domains = ['camera'] -%}
                  {%- for domain in domains -%}
                    {%- for item in states[domain] -%}
                      {% if loop.first %}
                        {{loop.length}}
                      {% endif %}
                    {%- endfor -%}
                  {%- endfor -%}
            icon: mdi:cctv
            
          - name: count_cameras_unavailable
            state: "{{states.camera | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon: mdi:alert-circle

      - trigger:
          - platform: state
            entity_id: input_button.telemetry_reload
        sensor:
          - name: all_light_on
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.light if is_state(entity.entity_id, 'on') and not (entity.entity_id.endswith("_virtual")) %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.light if is_state(entity.entity_id, 'on') and not (entity.entity_id.endswith("_virtual")) %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}
          - name: all_light_unavailable
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.light if is_state(entity.entity_id, 'unavailable') %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.light if is_state(entity.entity_id, 'unavailable') %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}
          - name: all_switch_on_10
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.switch if is_state(entity.entity_id, 'on') and state_attr(entity.entity_id, 'power') | int(0) > 10 %}
                    {% set variable.value = dict(variable.value, **{entity.name: state_attr(entity.entity_id, 'power') }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.switch if is_state(entity.entity_id, 'on') and state_attr(entity.entity_id, 'power') |int(0) > 10 %}
                        {% set variable.value = dict(variable.value, **{entity.name: state_attr(entity.entity_id, 'power') }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}
          - name: all_switch_unavailable
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.switch if is_state(entity.entity_id, 'unavailable') %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.switch if is_state(entity.entity_id, 'unavailable') %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}
          - name: all_binary_sensor_unavailable
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.binary_sensor if is_state(entity.entity_id, 'unavailable') %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.binary_sensor if is_state(entity.entity_id, 'unavailable') %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}
          - name: all_sensor_unavailable
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.sensor if is_state(entity.entity_id, 'unavailable') %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.sensor if is_state(entity.entity_id, 'unavailable') %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}
          - name: motion_detected
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.binary_sensor if is_state(entity.entity_id, 'on') and 
                                                         is_state_attr(entity.entity_id, 'device_class', 'motion') and 
                                                         not (entity.entity_id.endswith("_sensors")) %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.binary_sensor if is_state(entity.entity_id, 'on') and 
                                                             is_state_attr(entity.entity_id, 'device_class', 'motion') and 
                                                             not (entity.entity_id.endswith("_sensors")) %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}          
          - name: presence_detected
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.binary_sensor if is_state(entity.entity_id, 'on') and 
                                                         is_state_attr(entity.entity_id, 'device_class', 'presence') and 
                                                         not (entity.entity_id.endswith("_sensors")) %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.binary_sensor if is_state(entity.entity_id, 'on') and 
                                                                 is_state_attr(entity.entity_id, 'device_class', 'presence') and 
                                                                 not (entity.entity_id.endswith("_sensors")) %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}
          - name: open_window
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.binary_sensor if is_state(entity.entity_id, 'on') and 
                                                         is_state_attr(entity.entity_id, 'device_class', 'window') and 
                                                         not (entity.entity_id.endswith("_windows")) %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.binary_sensor if is_state(entity.entity_id, 'on') and 
                                                             is_state_attr(entity.entity_id, 'device_class', 'window') and 
                                                             not (entity.entity_id.endswith("_windows")) %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}         
          - name: open_door
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.binary_sensor if is_state(entity.entity_id, 'on') and 
                                                         is_state_attr(entity.entity_id, 'device_class', 'door')  and 
                                                         not (entity.entity_id.endswith("_doors")) %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.binary_sensor if is_state(entity.entity_id, 'on') and 
                                                             is_state_attr(entity.entity_id, 'device_class', 'door')  and 
                                                             not (entity.entity_id.endswith("_doors")) %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}
          - name: voltage_medium
            state: >
                {% set variable = namespace(value = {}) %}
                {% set voltage = namespace(value = 0) %}
                {% for entity in states.sensor if ( is_state_attr(entity.entity_id, 'device_class', 'voltage') and 
                                                   is_state_attr(entity.entity_id, 'unit_of_measurement', 'V') and 
                                                   states(entity.entity_id) not in ['unavailable','unknown','None'] and 
                                                   not (entity.entity_id.endswith("_meter_voltage")) and
                                                   not (entity.entity_id.endswith("battery_voltage")) and
                                                   not (entity.entity_id.endswith("aquarium_main_lighting_voltage")) ) %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% set voltage.value = voltage.value |int + entity.state |int %}
                {% endfor %}
                {{ (voltage.value / (variable.value | length) ) |round(2) }}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.sensor if ( is_state_attr(entity.entity_id, 'device_class', 'voltage') and 
                                                        is_state_attr(entity.entity_id, 'unit_of_measurement', 'V') and 
                                                        states(entity.entity_id) not in ['unavailable','unknown','None'] and 
                                                        not (entity.entity_id.endswith("_meter_voltage")) and
                                                        not (entity.entity_id.endswith("battery_voltage")) and
                                                        not (entity.entity_id.endswith("aquarium_main_lighting_voltage")) ) %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }} 
          - name: battery_lower_30
            state: >
                {% set variable = namespace(value = {}) %}
                {% for entity in states.sensor if is_state_attr(entity.entity_id, 'device_class', 'battery') and states(entity.entity_id) | int(0) < 30 %}
                    {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                {% endfor %}
                {% if (variable.value | length) | int > 0 %}
                    {{ variable.value | length }}
                {% else %}
                    0
                {% endif %}
            attributes:
                list_entities: >
                    {% set variable = namespace(value = {}) %}
                    {% for entity in states.sensor if is_state_attr(entity.entity_id, 'device_class', 'battery') and states(entity.entity_id) |int(0) < 30 %}
                        {% set variable.value = dict(variable.value, **{entity.name: entity.state }) %}
                    {% endfor %}
                    {{ variable.value |dictsort(false, 'value') }}

    automation:

      - alias: "Telegram: Telemetry"
        id: Телеметрия телеграм
        initial_state: true
        trigger: 
          - platform: event
            event_type: telegram_callback
            event_data: {}
        action:
          - choose:
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/telemetry'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        message: &msg_tlmtr |
                            {{'\U00002328'}} *Телеметрія*
                            ➖➖➖➖➖➖➖
                            *{{'\U0001F4C5'}} {{ states('sensor.date') }} {{'\U0001F551'}} {{ states('sensor.time') }}*
                            * *
                            {{'\U000026A0'}} *Аварійні сенсори:*
                             - {{'\U0001F6AB'}} *Газ:*{% if (states('sensor.gas_detect') | int) > 0 %} {{'\U000026A0'}} *Виявлено*{% else %} {{'\U0001F197'}}{% endif %}
                             - {{'\U0001F6AD'}} *Дим:*{% if (states('sensor.smoke_detect') | int) > 0 %} {{'\U000026A0'}} *Виявлено*{% else %} {{'\U0001F197'}}{% endif %}
                             - {{'\U0001F4A7'}} *Протікання:*{% if (states('sensor.water_leak_detect') | int) > 0 %} {{'\U000026A0'}} *Виявлено*{% else %} {{'\U0001F197'}}{% endif %}
                            * *
                            {{'\U0001F527'}} *Об'єкти:*
                            {{'\U000026A1'}} *Напруга в мережі:* {{ states('sensor.voltage_medium') }} V
                            {{'\U0001F4A1'}} *Світильники:*{% if (states('sensor.all_light_on') | int) > 0 %} увімкнено {{ states('sensor.all_light_on') }}{% else %} всі вимкнені{% endif %},{% if (states('sensor.all_light_unavailable') | int) > 0 %} *Недоступно:* {{ states('sensor.all_light_unavailable') }}{% else %} {{'\U0001F197'}}{% endif %}
                            {{'\U0001F50C'}} *Реле > 10W:*{% if (states('sensor.all_switch_on_10') | int) > 0 %} активно {{ states('sensor.all_switch_on_10') }}{% else %} нема активних{% endif %},{% if (states('sensor.all_switch_unavailable') | int) > 0 %} *Недоступно:* {{ states('sensor.all_switch_unavailable') }}{% else %} {{'\U0001F197'}}{% endif %}
                            {{'\U0001F51F'}} *Бінарні сенсори:*{% if (states('sensor.all_binary_sensor_unavailable') | int) > 0 %} недоступно - {{ states('sensor.all_binary_sensor_unavailable') }}{% else %} {{'\U0001F197'}}{% endif %}, {{'\U0001F520'}} *Сенсори:*{% if (states('sensor.all_sensor_unavailable') | int) > 0 %} недоступно - {{ states('sensor.all_sensor_unavailable') }}{% else %} {{'\U0001F197'}}{% endif %}
                            {{'\U0001F3C3'}} *Рух:*{% if (states('sensor.motion_detected') | int) > 0 %} {{ states('sensor.motion_detected') }} датчиків{% else %} руху немає{% endif %}, {{'\U0001F3E0'}} *Присутність:*{% if (states('sensor.presence_detected') | int) > 0 %} {{ states('sensor.presence_detected') }} датчиків{% else %} присутності немає{% endif %}
                            {{'\U0001FA9F'}} *Вікна:*{% if (states('sensor.open_window') | int) > 0 %} відчинено {{ states('sensor.open_window') }}{% else %} всі зачинені{% endif %}, {{'\U0001F6AA'}} *Двері:*{% if (states('sensor.open_door') | int) > 0 %} відчинені {{ states('sensor.open_door') }}{% else %} всі зачинені{% endif %}
                            {{'\U0001F50B'}} *Батарейки нижче 30%:*{% if (states('sensor.battery_lower_30') | int) > 0 %} - {{ states('sensor.battery_lower_30') }}{% else %} {{'\U00002705'}}{% endif %}
                        inline_keyboard: &keyb_tlmtr
                          - "{{'\U0001F4A1'}} Увімкнені :/list_light_on, {{'\U000026A0'}} Недоступні :/list_light_unavailable"
                          - "{{'\U000026A1'}} Більше 10 W:/list_all_switch_on_10, {{'\U0001F50C'}} Недоступні :/all_switch_unavailable"
                          - "{{'\U0001F51F'}} Бінарні сенсори :/list_all_binary_sensor_unavailable, {{'\U0001F520'}} Сенсори :/list_all_sensor_unavailable"
                          - "{{'\U0001F3C3'}} Рух :/list_motion_detected, {{'\U0001F3E0'}} Присутність :/list_presence_detected"
                          - "{{'\U0001FA9F'}} Відчинені вікна :/list_open_window, {{'\U0001F6AA'}} Відчинені двері :/list_open_door"
                          - "{{'\U0001F50B'}} Батарейки нижче 30% :/list_battery_lower_30"
                          - "{{'\U0001F501'}} Оновити:/telemetry, {{'\U0001F4D1'}} Меню:/menu"
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_light_on'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.all_light_on') | int) > 0 %}{{'\U0001F4A1'}} *Увімкнені світильники: * {% else %}*Усі світильники вимкнені* {% endif %}
                            * *
                            *{% for entity_name, entity_state in state_attr('sensor.all_light_on', 'list_entities')-%} - {{ entity_name }} {{ '\n' -}} {% endfor %}*
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_light_unavailable'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.all_light_unavailable') | int) > 0 %}{{"\U000026A0"}} *Недоступні світильники: * {% else %}*Усі світильники доступні* {% endif %}
                            * *
                            *{% for entity_name, entity_state in state_attr('sensor.all_light_unavailable', 'list_entities')-%} - {{ entity_name }} {{ '\n' -}} {% endfor %}*
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_all_switch_on_10'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.all_switch_on_10') | int) > 0 %}{{"\U000026A1"}} *Споживання більше 10W:* {% else %}*Споживання на всіх реле менше 10W* {% endif %}
                            * *
                            *{% for entity_name, entity_state in state_attr('sensor.all_switch_on_10', 'list_entities')-%} - {{ entity_name }} {{ '-' }} {{ entity_state }} {{ 'W' }} {{ '\n' -}} {% endfor %}*
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/all_switch_unavailable'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.all_switch_unavailable') | int) > 0 %}{{"\U0001F50C"}} *Недоступні реле: * {% else %}*Усі реле доступні* {% endif %}
                            *{% for entity_name, entity_state in state_attr('sensor.all_switch_unavailable', 'list_entities')-%} - {{ entity_name }} {{ '\n' -}} {% endfor %}*
                            * *
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_all_binary_sensor_unavailable'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.all_binary_sensor_unavailable') | int) > 0 %}{{"\U0001F50C"}} *Недоступні бінарні сенсори: * {% else %}*Усі бінарні сенсори доступні* {% endif %}
                            *{% for entity_name, entity_state in state_attr('sensor.all_binary_sensor_unavailable', 'list_entities')-%} - {{ entity_name }} {{ '\n' -}} {% endfor %}*
                            * *
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_all_sensor_unavailable'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.all_sensor_unavailable') | int) > 0 %}{{"\U0001F50C"}} *Недоступні сенсори: * {% else %}*Усі сенсори доступні* {% endif %}
                            *{% for entity_name, entity_state in state_attr('sensor.all_sensor_unavailable', 'list_entities')-%} - {{ entity_name }} {{ '\n' -}} {% endfor %}*
                            * *
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_motion_detected'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.motion_detected') | int) > 0 %}{{"\U0001F3C3"}} *Рух: * {% else %}*Рух не виявлено* {% endif %}
                            * *
                            *{% for entity_name, entity_state in state_attr('sensor.motion_detected', 'list_entities')-%} - {{ entity_name }} {{ '\n' -}} {% endfor %}*
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_presence_detected'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.presence_detected') | int) > 0 %}{{"\U0001F3E0"}} *Присутність: * {% else %}*Присутність не виявлено* {% endif %}
                            * *
                            *{% for entity_name, entity_state in state_attr('sensor.presence_detected', 'list_entities')-%} - {{ entity_name }} {{ '\n' -}} {% endfor %}*
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_open_window'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.open_window') | int) > 0 %}{{"\U0001FA9F"}} *Відчинені вікна: * {% else %}*Усі вікна зачинені* {% endif %}
                            * *
                            *{% for entity_name, entity_state in state_attr('sensor.open_window', 'list_entities')-%} - {{ entity_name }} {{ '\n' -}} {% endfor %}*
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_open_door'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                        milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                        message_id: '{{ trigger.event.data.message.message_id }}'
                        chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                        target: '{{ trigger.event.data.chat_id }}'
                        title: *msg_tlmtr
                        message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.open_door') | int) > 0 %}{{"\U0001F6AA"}} *Відчинені двері: * {% else %}*Усі двері зачинені* {% endif %}
                            * *
                            *{% for entity_name, entity_state in state_attr('sensor.open_door', 'list_entities')-%} - {{ entity_name }} {{ '\n' -}} {% endfor %}*
                        inline_keyboard: *keyb_tlmtr
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/list_battery_lower_30'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.telemetry_reload
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      title: *msg_tlmtr
                      message: |
                            ➖➖➖➖➖➖➖
                            {% if (states('sensor.battery_lower_30') | int) > 0 %}{{"\U0001F50B"}} *Батарейки, що розряджаються: * {% else %}*Усі батарейки в порядку* {% endif %}
                            * *
                            *{% for entity_name, entity_state in state_attr('sensor.battery_lower_30', 'list_entities')-%} - {{ entity_name }} {{ '-' }} {{ entity_state }} {{ '%' }} {{ '\n' -}} {% endfor %}*
                      inline_keyboard: *keyb_tlmtr
        mode: single
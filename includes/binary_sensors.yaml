    - platform: group
      name: bedroom_windows
      device_class: window
      entities:
        - binary_sensor.bedroom_window_left_contact
        - binary_sensor.bedroom_window_right_contact

    - platform: group
      name: home_windows
      device_class: window
      entities:
        - binary_sensor.bedroom_window_left_contact
        - binary_sensor.bedroom_window_right_contact
        - binary_sensor.kitchen_window_contact
        - binary_sensor.living_room_loggia_door_contact

    - platform: group
      name: motion_sensors
      device_class: motion
      entities:
        - binary_sensor.bedroom_lumi_sensor_motion_occupancy
        - binary_sensor.living_room_lumi_sensor_motion_occupancy
        - binary_sensor.tapo_camera_motion

    - platform: group
      name: m_novomoskovsk_alerts
      device_class: safety
      entities:
        - binary_sensor.m_novomoskovsk_ta_novomoskovska_teritorialna_gromada_air
        - binary_sensor.m_novomoskovsk_ta_novomoskovska_teritorialna_gromada_artillery
        - binary_sensor.m_novomoskovsk_ta_novomoskovska_teritorialna_gromada_urban_fights
        - binary_sensor.m_novomoskovsk_ta_novomoskovska_teritorialna_gromada_unknown

    - platform: template
      sensors:

        anyone_home:
          device_class: presence
          friendly_name: 'Anyone Home'
          value_template: "{{ states.person | selectattr('state','eq','home') | list | count > 0 }}"

        ups_battery_low:
          device_class: problem
          friendly_name: "Состояние батареи UPS"
          value_template: >-
            {% if (states("sensor.ups_battery_capacity") | int(0) < 25) or (states("sensor.ups_battery_voltage") | float(0) < 3.2) %}
            on
            {% else %}
            off
            {% endif %}
          icon_template: >-
            {% if is_state("binary_sensor.ups_battery_low", "on") %}
              {% if (states("sensor.ups_battery_voltage") | float(0) >= 4.21 ) %}
              mdi:battery-charging-low
              {% else %}
              mdi:battery-low
              {% endif %}
            {% elif (states("sensor.ups_battery_capacity") | int(0) >=25) and (states("sensor.ups_battery_capacity") | int(0) < 75) %}
              {% if (states("sensor.ups_battery_voltage") | float(0) >= 4.21 ) %}
              mdi:battery-charging-medium
              {% else %}
              mdi:battery-medium
              {% endif %}
            {% else %}
              {% if (states("sensor.ups_battery_voltage") | float(0) >= 4.21 ) %}
              mdi:battery-charging-high
              {% else %}
              mdi:battery-high
              {% endif %}
            {% endif %}

        rpi_ac_power_status:
          device_class: plug
          friendly_name: "Источник внешнего питания"
          value_template: >- 
            {% if   states.sensor.file_ac_power_status.state  == "1" %}
            off
            {% elif states.sensor.file_ac_power_status.state  == "2" %}
            on
            {% else %}
            {{ none }} 
            {% endif %}
          availability_template: >-
            {{ not states.sensor.file_ac_power_status.state  == "" }}

        bathroom_washing_machine_socket_status:
          friendly_name: "Стиральная машина"
          value_template: >-
            {% if (states("sensor.bathroom_washing_machine_socket_power") | int(0) > 1) %}
            on
            {% else %}
            off
            {% endif %}
          icon_template: >-
            {% if is_state("binary_sensor.bathroom_washing_machine_socket_status","on") and (states("sensor.bathroom_washing_machine_socket_power") | int(0) > 3) %}
            mdi:washing-machine
            {% elif is_state("binary_sensor.bathroom_washing_machine_socket_status","on") and (states("sensor.bathroom_washing_machine_socket_power") | int(0) < 4) %}
            mdi:washing-machine-alert
            {% else %}
            mdi:washing-machine-off
            {% endif %}

        bedroom_air_conditioner_socket_status:
          friendly_name: "Кондиционер в Спальне"
          value_template: >-
            {% if (states("sensor.bedroom_air_conditioner_socket_power") | int(0) > 8) %}
            on
            {% else %}
            off
            {% endif %}
          icon_template: >-
            {% if is_state("binary_sensor.bedroom_air_conditioner_socket_status","on") %}
            mdi:hvac
            {% else %}
            mdi:hvac-off
            {% endif %}

        living_room_air_conditioner_socket_status:
          friendly_name: "Кондиционер в Гостинной"
          value_template: >-
            {% if (states("sensor.living_room_air_conditioner_socket_power") | int(0) > 8) %}
            on
            {% else %}
            off
            {% endif %}
          icon_template: >-
            {% if is_state("binary_sensor.living_room_air_conditioner_socket_status","on") %}
            mdi:hvac
            {% else %}
            mdi:hvac-off
            {% endif %}

        bedroom_socket_heating_status:
          friendly_name: "Обогреватель в Спальне"
        # {% if is_state("input_boolean.heating_status","on") and is_state("switch.bedroom_socket_heating","on") %}
          value_template: >-
            {% if (states("sensor.bedroom_socket_heating_power") | int(0) > 0) %}
            on
            {% else %}
            off
            {% endif %}
          icon_template: >-
            {% if is_state("binary_sensor.bedroom_socket_heating_status","on") %}
            mdi:radiator
            {% elif is_state("input_boolean.heating_status","off") %}
            mdi:radiator-off
            {% else %}
            mdi:radiator-disabled
            {% endif %}

        living_room_socket_heating_status:
          friendly_name: "Обогреватель в Гостинной"
            # {% if is_state("input_boolean.heating_status","on") and is_state("switch.living_room_socket_heating","on") %}
          value_template: >-
            {% if (states("sensor.living_room_socket_heating_power") | int(0) > 0) %}
            on
            {% else %}
            off
            {% endif %}
          icon_template: >-
            {% if is_state("binary_sensor.living_room_socket_heating_status","on") %}
            mdi:radiator
            {% elif is_state("input_boolean.heating_status","off") %}
            mdi:radiator-off
            {% else %}
            mdi:radiator-disabled
            {% endif %}

        kitchen_socket_heating_status:
          friendly_name: "Обогреватель в Кухне"
            # {% if is_state("input_boolean.heating_status","on") and is_state("switch.kitchen_socket_heating","on") %}
          value_template: >-
            {% if (states("sensor.kitchen_socket_heating_power") | int(0) > 0) %}
            on
            {% else %}
            off
            {% endif %}
          icon_template: >-
            {% if is_state("binary_sensor.kitchen_socket_heating_status","on") %}
            mdi:radiator
            {% elif is_state("input_boolean.heating_status","off") %}
            mdi:radiator-off
            {% else %}
            mdi:radiator-disabled
            {% endif %}
